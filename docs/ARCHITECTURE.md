# UniSave Architecture ‚Äî MVP v4

graph TD
    %% –£—á–∞—Å—Ç–Ω–∏–∫–∏
    User(üë®‚Äçüéì –°—Ç—É–¥–µ–Ω—Ç)
    Front(üíª Frontend / React)
    Back(‚öôÔ∏è Backend / Django)
    DB[(üóÑÔ∏è –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö / SQLite)]
    AI(üß† Google Gemini API)

    %% –°–≤—è–∑–∏ (–ö—Ç–æ —á—Ç–æ –¥–µ–ª–∞–µ—Ç)
    User -- 1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–Ω–∏–≥—É PDF --> Front
    Front -- 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª --> Back
    
    Back -- 3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—Å—Ç –∫–Ω–∏–≥–∏ --> DB
    
    User -- 4. –ó–∞–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å --> Front
    Front -- 5. –ü–µ—Ä–µ–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å --> Back
    
    Back -- 6. –ò—â–µ—Ç –Ω—É–∂–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã --> DB
    DB -.-> Back
    
    Back -- 7. –®–ª–µ—Ç –≤–æ–ø—Ä–æ—Å + —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü --> AI
    AI -- 8. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç (JSON) --> Back
    
    Back -- 9. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–¥–∏–≤–æ—Å—Ç—å (–í–∞–ª–∏–¥–∞—Ü–∏—è) --> Back
    
    Back -- 10. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç --> Front


graph TD
    %% –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    Input(üìÑ –¢–≤–æ–π PDF —Ñ–∞–π–ª) --> Parser(üëÄ PyMuPDF / –ß–∏—Ç–∞—Ç–µ–ª—å)

    %% –®–∞–≥ 1: –î–æ—Å—Ç–∞–µ–º —Ç–µ–∫—Å—Ç
    Parser -- –ß–∏—Ç–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É 1 --> RawText(üìù –°—ã—Ä–æ–π —Ç–µ–∫—Å—Ç)
    
    %% –ü–æ—è—Å–Ω–µ–Ω–∏–µ: –°—ã—Ä–æ–π —Ç–µ–∫—Å—Ç - —ç—Ç–æ —Ç–µ–∫—Å—Ç —Å –º—É—Å–æ—Ä–æ–º, –ø—Ä–æ–±–µ–ª–∞–º–∏, –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏ —Å—Ç—Ä–æ–∫.
    
    %% –®–∞–≥ 2: –£–±–æ—Ä–∫–∞
    RawText --> Cleaner(üßπ –ß–∏—Å—Ç–∏–ª—å—â–∏–∫)
    Cleaner -- –£–±–∏—Ä–∞–µ—Ç –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏ \n --> CleanText(‚ú® –ß–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç)
    
    %% –®–∞–≥ 3: –ù–∞—Ä–µ–∑–∫–∞
    CleanText --> Slicer(üî™ –ù–∞—Ä–µ–∑—á–∏–∫ / Chunking)
    
    %% –®–∞–≥ 4: –†–µ–∑—É–ª—å—Ç–∞—Ç
    Slicer -- –†–µ–∂–µ—Ç –ø–æ ~1000 —Å–∏–º–≤–æ–ª–æ–≤ --> Chunk1(üß© –ö—É—Å–æ–∫ 1)
    Slicer -- –†–µ–∂–µ—Ç –¥–∞–ª—å—à–µ --> Chunk2(üß© –ö—É—Å–æ–∫ 2)
    Slicer -- –ò —Ç–∞–∫ –¥–∞–ª–µ–µ... --> Chunk3(üß© –ö—É—Å–æ–∫ 3)
    
    %% –§–∏–Ω–∞–ª: –°–∫–ª–∞–¥
    Chunk1 --> DB[(üóÑÔ∏è –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö)]
    Chunk2 --> DB
    Chunk3 --> DB

sequenceDiagram
    participant U as üë®‚Äçüéì –¢—ã (User)
    participant B as ‚öôÔ∏è Django (Backend)
    participant DB as üóÑÔ∏è –ë–∞–∑–∞ (Chunks)
    participant AI as üß† Gemini (AI)

    %% 1. –ü–æ–∏—Å–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    U->>B: –í–æ–ø—Ä–æ—Å: "–ß—Ç–æ —Ç–∞–∫–æ–µ —ç–Ω—Ç—Ä–æ–ø–∏—è?"
    Note over B, DB: –≠—Ç–∞–ø 1: –†–∞–∑–≤–µ–¥–∫–∞
    B->>DB: –ò—â–µ—Ç —á–∞–Ω–∫–∏ —Å–æ —Å–ª–æ–≤–æ–º "—ç–Ω—Ç—Ä–æ–ø–∏—è"
    DB-->>B: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 3 –ª—É—á—à–∏—Ö –∫—É—Å–æ—á–∫–∞ —Ç–µ–∫—Å—Ç–∞

    %% 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
    Note over B, AI: –≠—Ç–∞–ø 2: –≠–∫–∑–∞–º–µ–Ω
    B->>AI: –®–ª–µ—Ç –≤–æ–ø—Ä–æ—Å + —ç—Ç–∏ 3 –∫—É—Å–æ—á–∫–∞ —Ç–µ–∫—Å—Ç–∞
    AI-->>B: –û—Ç–≤–µ—á–∞–µ—Ç (JSON): "–≠–Ω—Ç—Ä–æ–ø–∏—è —ç—Ç–æ —Ö–∞–æ—Å. –¶–∏—Ç–∞—Ç–∞: '–º–µ—Ä–∞ –±–µ—Å–ø–æ—Ä—è–¥–∫–∞'"

    %% 3. –í–∞–ª–∏–¥–∞—Ü–∏—è (–°–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ!)
    Note over B: –≠—Ç–∞–ø 3: –°—Ç—Ä–æ–≥–∞—è –ü—Ä–æ–≤–µ—Ä–∫–∞ (Python)
    loop –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–∫—Ç–∞
        B->>B: –ò—â–µ—Ç —Ü–∏—Ç–∞—Ç—É "'–º–µ—Ä–∞ –±–µ—Å–ø–æ—Ä—è–¥–∫–∞'" –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ
        alt –¢–µ–∫—Å—Ç –Ω–∞–π–¥–µ–Ω?
            B->>B: ‚úÖ –°—Ç–∞–≤–∏—Ç —à—Ç–∞–º–ø "VERIFIED"
            B->>B: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (–¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏)
        else –¢–µ–∫—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω?
            B->>B: ‚ö†Ô∏è –°—Ç–∞–≤–∏—Ç —à—Ç–∞–º–ø "UNVERIFIED"
        end
    end

    %% 4. –†–µ–∑—É–ª—å—Ç–∞—Ç
    B->>U: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç —Å —Ü–≤–µ—Ç–Ω—ã–º–∏ –ø–æ–º–µ—Ç–∫–∞–º–∏